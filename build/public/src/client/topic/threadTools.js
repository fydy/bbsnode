"use strict";define("forum/topic/threadTools",["components","translator"],function(t,e){var o={};o.init=function(t){i();var e=$(".topic");e.on("click",'[component="topic/delete"]',function(){n("delete",t);return false});e.on("click",'[component="topic/restore"]',function(){n("restore",t);return false});e.on("click",'[component="topic/purge"]',function(){n("purge",t);return false});e.on("click",'[component="topic/lock"]',function(){socket.emit("topics.lock",{tids:[t],cid:ajaxify.data.cid});return false});e.on("click",'[component="topic/unlock"]',function(){socket.emit("topics.unlock",{tids:[t],cid:ajaxify.data.cid});return false});e.on("click",'[component="topic/pin"]',function(){socket.emit("topics.pin",{tids:[t],cid:ajaxify.data.cid});return false});e.on("click",'[component="topic/unpin"]',function(){socket.emit("topics.unpin",{tids:[t],cid:ajaxify.data.cid});return false});e.on("click",'[component="topic/mark-unread"]',function(){socket.emit("topics.markUnread",t,function(t){if(t){return app.alertError(t)}app.alertSuccess("[[topic:mark_unread.success]]")});return false});e.on("click",'[component="topic/mark-unread-for-all"]',function(){var e=$(this);socket.emit("topics.markAsUnreadForAll",[t],function(t){if(t){return app.alertError(t.message)}app.alertSuccess("[[topic:markAsUnreadForAll.success]]");e.parents(".thread-tools.open").find(".dropdown-toggle").trigger("click")});return false});e.on("click",'[component="topic/move"]',function(){require(["forum/topic/move"],function(e){e.init([t],ajaxify.data.cid)});return false});e.on("click",'[component="topic/delete/posts"]',function(){require(["forum/topic/delete-posts"],function(t){t.init()})});e.on("click",'[component="topic/fork"]',function(){require(["forum/topic/fork"],function(t){t.init()})});e.on("click",'[component="topic/move-posts"]',function(){require(["forum/topic/move-post"],function(t){t.init()})});e.on("click",'[component="topic/following"]',function(){o("follow")});e.on("click",'[component="topic/not-following"]',function(){o("unfollow")});e.on("click",'[component="topic/ignoring"]',function(){o("ignore")});function o(e){socket.emit("topics.changeWatching",{tid:t,type:e},function(o){if(o){return app.alert({type:"danger",alert_id:"topic_follow",title:"[[global:please_log_in]]",message:"[[topic:login_to_subscribe]]",timeout:5e3})}var i="";if(e==="follow"){i="[[topic:following_topic.message]]"}else if(e==="unfollow"){i="[[topic:not_following_topic.message]]"}else if(e==="ignore"){i="[[topic:ignoring_topic.message]]"}c(e);app.alert({alert_id:"follow_thread",message:i,type:"success",timeout:5e3});$(window).trigger("action:topics.changeWatching",{tid:t,type:e})});return false}};function i(){$(".topic").on("show.bs.dropdown",".thread-tools",function(){var t=$(this);var e=t.find(".dropdown-menu");if(e.html()){return}socket.emit("topics.loadTopicTools",{tid:ajaxify.data.tid,cid:ajaxify.data.cid},function(t,o){if(t){return app.alertError(t)}app.parseAndTranslate("partials/topic/topic-menu-list",o,function(t){e.html(t);$(window).trigger("action:topic.tools.load")})})})}function n(t,o){e.translate("[[topic:thread_tools."+t+"_confirm]]",function(e){bootbox.confirm(e,function(e){if(!e){return}socket.emit("topics."+t,{tids:[o],cid:ajaxify.data.cid},function(t){if(t){app.alertError(t.message)}})})})}o.setLockedState=function(e){var o=t.get("topic");if(parseInt(e.tid,10)!==parseInt(o.attr("data-tid"),10)){return}var i=e.isLocked&&!ajaxify.data.privileges.isAdminOrMod;t.get("topic/lock").toggleClass("hidden",e.isLocked).parent().attr("hidden",e.isLocked?"":null);t.get("topic/unlock").toggleClass("hidden",!e.isLocked).parent().attr("hidden",!e.isLocked?"":null);var n=(e.isLocked||ajaxify.data.deleted)&&!ajaxify.data.privileges.isAdminOrMod;t.get("topic/reply/container").toggleClass("hidden",n);t.get("topic/reply/locked").toggleClass("hidden",ajaxify.data.privileges.isAdminOrMod||!e.isLocked||ajaxify.data.deleted);o.find('[component="post"]:not(.deleted) [component="post/reply"], [component="post"]:not(.deleted) [component="post/quote"]').toggleClass("hidden",n);o.find('[component="post/edit"], [component="post/delete"]').toggleClass("hidden",i);o.find('[component="post"][data-uid="'+app.user.uid+'"].deleted [component="post/tools"]').toggleClass("hidden",i);$('[component="post/header"] i.fa-lock').toggleClass("hidden",!e.isLocked);$('[component="post/tools"] .dropdown-menu').html("");ajaxify.data.locked=e.isLocked};o.setDeleteState=function(e){var o=t.get("topic");if(parseInt(e.tid,10)!==parseInt(o.attr("data-tid"),10)){return}t.get("topic/delete").toggleClass("hidden",e.isDelete).parent().attr("hidden",e.isDelete?"":null);t.get("topic/restore").toggleClass("hidden",!e.isDelete).parent().attr("hidden",!e.isDelete?"":null);t.get("topic/purge").toggleClass("hidden",!e.isDelete).parent().attr("hidden",!e.isDelete?"":null);t.get("topic/deleted/message").toggleClass("hidden",!e.isDelete);var i=e.isDelete&&!ajaxify.data.privileges.isAdminOrMod;t.get("topic/reply/container").toggleClass("hidden",i);t.get("topic/reply/locked").toggleClass("hidden",ajaxify.data.privileges.isAdminOrMod||!ajaxify.data.locked||e.isDelete);o.find('[component="post"]:not(.deleted) [component="post/reply"], [component="post"]:not(.deleted) [component="post/quote"]').toggleClass("hidden",i);o.toggleClass("deleted",e.isDelete);ajaxify.data.deleted=e.isDelete};o.setPinnedState=function(e){var o=t.get("topic");if(parseInt(e.tid,10)!==parseInt(o.attr("data-tid"),10)){return}t.get("topic/pin").toggleClass("hidden",e.isPinned).parent().attr("hidden",e.isPinned?"":null);t.get("topic/unpin").toggleClass("hidden",!e.isPinned).parent().attr("hidden",!e.isPinned?"":null);$('[component="post/header"] i.fa-thumb-tack').toggleClass("hidden",!e.isPinned);ajaxify.data.pinned=e.isPinned};function c(e){var o=t.get("topic/following/menu");o.toggleClass("hidden",e!=="follow");t.get("topic/following/check").toggleClass("fa-check",e==="follow");o=t.get("topic/not-following/menu");o.toggleClass("hidden",e!=="unfollow");t.get("topic/not-following/check").toggleClass("fa-check",e==="unfollow");o=t.get("topic/ignoring/menu");o.toggleClass("hidden",e!=="ignore");t.get("topic/ignoring/check").toggleClass("fa-check",e==="ignore")}return o});
//# sourceMappingURL=threadTools.js.map