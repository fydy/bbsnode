"use strict";define("navigator",["forum/pagination","components"],function(t,o){var e={};var n=1;var i=0;var a;var r;var l;var c;var s;e.scrollActive=false;var f=$(".pagination-block");var d=f.find(".pagination-text");var u=f.find("meter");var p=f.find(".progress-bar");$(window).on("action:ajaxify.start",function(){$(window).off("keydown",v)});e.init=function(t,o,i,a,s,v){n=1;e.selector=t;e.callback=s;e.toTop=i||function(){};e.toBottom=a||function(){};f=$(".pagination-block");d=f.find(".pagination-text");u=f.find("meter");p=f.find(".progress-bar");$(window).off("scroll",e.delayedUpdate).on("scroll",e.delayedUpdate);f.find(".dropdown-menu").off("click").on("click",function(t){t.stopPropagation()});f.off("shown.bs.dropdown",".dropdown").on("shown.bs.dropdown",".dropdown",function(){setTimeout(function(){$(".pagination-block input").focus()},100)});f.find(".pageup").off("click").on("click",e.scrollUp);f.find(".pagedown").off("click").on("click",e.scrollDown);f.find(".pagetop").off("click").on("click",e.toTop);f.find(".pagebottom").off("click").on("click",e.toBottom);f.find("input").on("keydown",function(t){if(t.which===13){var e=$(this);if(!utils.isNumber(e.val())){e.val("");return}var n=parseInt(e.val(),10);if(typeof v==="function"){n=v(n,o)}var i=m(n);e.val("");$(".pagination-block .dropdown-toggle").trigger("click");ajaxify.go(i)}});$(".pagination-block.visible-xs").on("touchstart",function(t){r=$(".navigator-thumb");r.removeClass("hidden");c=Math.min($(window).width(),Math.max(0,t.touches[0].clientX));g();l=setInterval(g,100)}).on("touchmove",function(t){t.preventDefault();t.stopPropagation();var i=$(window).width();c=Math.min(i,Math.max(0,t.touches[0].clientX));var a=c/i;n=Math.max(1,Math.ceil(o*a));n=n>o?o:n;e.updateTextAndProgressBar()}).on("touchend",function(){if(l){clearInterval(l);l=0}r.addClass("hidden");e.scrollToIndex(n-1,true,0)});h();e.setCount(o);e.update(0)};function g(){if(s===n){return}s=n;r.css({left:Math.min($(window).width()-r.outerWidth(),Math.max(c-r.outerWidth()/2,0))});socket.emit("posts.getTimestampByIndex",{tid:ajaxify.data.tid,index:n-1},function(t,o){if(t){return app.alertError(t.message)}var e=x();var n=new Date(o);var a=n.toLocaleString(config.userLang,{month:"long"});r.find(".text").translateText("[[global:pagination.out_of, "+e+", "+i+"]]");if(o>Date.now()-30*24*60*60*1e3){r.find(".time").text(a+" "+n.getDate())}else{r.find(".time").text(a+" "+n.getFullYear())}})}function h(){if(!config.usePagination){$(window).off("keydown",v).on("keydown",v)}}function v(t){if(t.target.nodeName==="BODY"){if(t.shiftKey||t.ctrlKey||t.altKey){return}if(t.which===36&&e.toTop){e.toTop();return false}else if(t.which===35&&e.toBottom){e.toBottom();return false}}}function m(t){var o=window.location.pathname.replace(config.relative_path,"");var e=o.split("/");return e[1]+"/"+e[2]+"/"+e[3]+(t?"/"+t:"")}e.setCount=function(t){i=parseInt(t,10);e.updateTextAndProgressBar()};e.show=function(){w(true)};e.disable=function(){i=0;n=1;e.callback=null;e.selector=null;$(window).off("scroll",e.delayedUpdate);w(false)};function w(t){var o=ajaxify.removeRelativePath(window.location.pathname.slice(1));if(t&&(!o.startsWith("topic")&&!o.startsWith("category"))){return}f.toggleClass("ready",t)}e.delayedUpdate=function(){if(!a){a=setTimeout(function(){e.update();a=undefined},100)}};e.update=function(t){t=typeof t==="number"?t:undefined;var a=$(e.selector);if(a.length){n=parseInt(a.first().attr("data-index"),10)+1}var r=$(window).scrollTop();var l=$(window).height();var c=$(document).height();var s=r+l/2;var f=Number.MAX_VALUE;a.each(function(){var t=Math.abs(s-$(this).offset().top);if(t>f){return false}if(t<f){n=parseInt($(this).attr("data-index"),10)+1;f=t}});var d=r===0&&parseInt(a.first().attr("data-index"),10)===0;var u=r+l>c-100&&parseInt(a.last().attr("data-index"),10)===i-1;if(d){n=1}else if(u){n=i}if(t===undefined&&ajaxify.data.template.topic===true){if(d){t=0}else{var p=o.get("post/anchor",n-1);if(p.length){var g=p.get(0).getBoundingClientRect();t=g.top}}}if(typeof e.callback==="function"){e.callback(n,i,t)}e.updateTextAndProgressBar();w(!!i)};e.updateTextAndProgressBar=function(){if(!utils.isNumber(n)){return}n=n>i?i:n;var t=x();d.translateHtml("[[global:pagination.out_of, "+t+", "+i+"]]");var o=(t-1)/(i-1||1);u.val(o);p.width(o*100+"%")};function x(){var t=n;if(t===1){return 1}if(ajaxify.data.template.topic){if(config.topicPostSort==="most_votes"||config.topicPostSort==="newest_to_oldest"){t=ajaxify.data.postcount-n+2}}return t}e.scrollUp=function(){var o=$(window);if(config.usePagination){var e=o.scrollTop()<=0;if(e){return t.previousPage(function(){$("body,html").scrollTop($(document).height()-o.height())})}}$("body,html").animate({scrollTop:o.scrollTop()-o.height()})};e.scrollDown=function(){var o=$(window);if(config.usePagination){var e=o.scrollTop()>=$(document).height()-o.height();if(e){return t.nextPage()}}$("body,html").animate({scrollTop:o.scrollTop()+o.height()})};e.scrollTop=function(t){if($(e.selector+'[data-index="'+t+'"]').length){e.scrollToIndex(t,true)}else{ajaxify.go(m())}};e.scrollBottom=function(t){if(parseInt(t,10)<0){return}if($(e.selector+'[data-index="'+t+'"]').length){e.scrollToIndex(t,true)}else{t=parseInt(t,10)+1;ajaxify.go(m(t))}};e.scrollToIndex=function(n,i,a){var r=!!o.get("topic").length;var l=!!o.get("category").length;if(!utils.isNumber(n)||!r&&!l){return}a=a!==undefined?a:400;e.scrollActive=true;if(r&&o.get("post/anchor",n).length){return e.scrollToPostIndex(n,i,a)}if(l&&$('[component="category/topic"][data-index="'+n+'"]').length){return e.scrollToTopicIndex(n,i,a)}if(!config.usePagination){e.scrollActive=false;n=parseInt(n,10)+1;ajaxify.go(m(n));return}var c=r?e.scrollToPostIndex:e.scrollToTopicIndex;if(r){if(config.topicPostSort==="most_votes"||config.topicPostSort==="newest_to_oldest"){n=ajaxify.data.postcount-n}}else if(l){if(config.categoryTopicSort==="most_posts"||config.categoryTopicSort==="oldest_to_newest"){n=ajaxify.data.topic_count-n}}var s=Math.max(1,Math.ceil((n+1)/config.postsPerPage));if(parseInt(s,10)!==ajaxify.data.pagination.currentPage){t.loadPage(s,function(){c(n,i,a)})}else{c(n,i,a)}};e.scrollToPostIndex=function(t,n,i){var a=o.get("post","index",t);e.scrollToElement(a,n,i)};e.scrollToTopicIndex=function(t,o,n){var i=$('[component="category/topic"][data-index="'+t+'"]');e.scrollToElement(i,o,n)};e.scrollToElement=function(t,n,i){if(!t.length){e.scrollActive=false;return}var a=t.height();var r=$(window).height();var l=o.get("navbar").height();$(window).off("scroll",e.update);i=i!==undefined?i:400;e.scrollActive=true;var c=false;function s(){function o(){if(c){$(window).on("scroll",e.update);var o=t.get(0).getBoundingClientRect();e.update(o.top);return}c=true;e.scrollActive=false;f();$("body").scrollTop($("body").scrollTop()-1);$("html").scrollTop($("html").scrollTop()-1)}var n=0;if(a<r){n=t.offset().top-r/2+a/2}else{n=t.offset().top-l}if(i===0){$(window).scrollTop(n);return o()}$("html, body").animate({scrollTop:n+"px"},i,o)}function f(){if(n){t.addClass("highlight");setTimeout(function(){t.removeClass("highlight")},1e4)}}s()};return e});
//# sourceMappingURL=navigator.js.map