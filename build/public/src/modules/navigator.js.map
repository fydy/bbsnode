{"version":3,"sources":["public/src/modules/navigator.js"],"names":["define","pagination","components","navigator","index","count","navigatorUpdateTimeoutId","touchTooltipEl","touchIntervalId","touchX","touchIndex","scrollActive","paginationBlockEl","$","paginationTextEl","find","paginationBlockMeterEl","paginationBlockProgressEl","window","on","off","onKeyDown","init","selector","toTop","toBottom","callback","calculateIndex","delayedUpdate","e","stopPropagation","setTimeout","focus","scrollUp","scrollDown","which","input","this","utils","isNumber","val","parseInt","url","generateUrl","trigger","ajaxify","go","removeClass","Math","min","width","max","touches","clientX","updateTooltip","setInterval","preventDefault","windowWidth","percent","ceil","updateTextAndProgressBar","clearInterval","addClass","scrollToIndex","handleKeys","setCount","update","css","left","outerWidth","socket","emit","tid","data","err","timestamp","app","alertError","message","relIndex","getRelativeIndex","date","Date","ds","toLocaleString","config","userLang","month","translateText","now","text","getDate","getFullYear","usePagination","ev","target","nodeName","shiftKey","ctrlKey","altKey","pathname","location","replace","relative_path","parts","split","value","show","toggle","disable","flag","path","removeRelativePath","slice","startsWith","toggleClass","undefined","threshold","els","length","first","attr","scrollTop","windowHeight","height","documentHeight","document","middleOfViewport","previousDistance","Number","MAX_VALUE","each","distanceToMiddle","abs","offset","top","atTop","nearBottom","last","template","topic","anchorEl","get","anchorRect","getBoundingClientRect","translateHtml","fraction","topicPostSort","postcount","$window","previousPage","animate","atBottom","nextPage","scrollBottom","highlight","duration","inTopic","inCategory","scrollToPostIndex","scrollToTopicIndex","scrollMethod","categoryTopicSort","topic_count","page","postsPerPage","currentPage","loadPage","postIndex","scrollTo","scrollToElement","topicIndex","postHeight","viewportHeight","navbarHeight","done","animateScroll","onAnimateComplete","scrollToRect","highlightPost"],"mappings":"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","file":"public/src/modules/navigator.js","sourcesContent":["'use strict';\n\ndefine('navigator', ['forum/pagination', 'components'], function (pagination, components) {\n\tvar navigator = {};\n\tvar index = 1;\n\tvar count = 0;\n\tvar navigatorUpdateTimeoutId;\n\n\tvar touchTooltipEl;\n\tvar touchIntervalId;\n\tvar touchX;\n\tvar touchIndex;\n\n\tnavigator.scrollActive = false;\n\n\tvar paginationBlockEl = $('.pagination-block');\n\tvar paginationTextEl = paginationBlockEl.find('.pagination-text');\n\tvar paginationBlockMeterEl = paginationBlockEl.find('meter');\n\tvar paginationBlockProgressEl = paginationBlockEl.find('.progress-bar');\n\n\t$(window).on('action:ajaxify.start', function () {\n\t\t$(window).off('keydown', onKeyDown);\n\t});\n\n\tnavigator.init = function (selector, count, toTop, toBottom, callback, calculateIndex) {\n\t\tindex = 1;\n\t\tnavigator.selector = selector;\n\t\tnavigator.callback = callback;\n\t\tnavigator.toTop = toTop || function () {};\n\t\tnavigator.toBottom = toBottom || function () {};\n\n\t\tpaginationBlockEl = $('.pagination-block');\n\t\tpaginationTextEl = paginationBlockEl.find('.pagination-text');\n\t\tpaginationBlockMeterEl = paginationBlockEl.find('meter');\n\t\tpaginationBlockProgressEl = paginationBlockEl.find('.progress-bar');\n\n\t\t$(window).off('scroll', navigator.delayedUpdate).on('scroll', navigator.delayedUpdate);\n\n\t\tpaginationBlockEl.find('.dropdown-menu').off('click').on('click', function (e) {\n\t\t\te.stopPropagation();\n\t\t});\n\n\t\tpaginationBlockEl.off('shown.bs.dropdown', '.dropdown').on('shown.bs.dropdown', '.dropdown', function () {\n\t\t\tsetTimeout(function () {\n\t\t\t\t$('.pagination-block input').focus();\n\t\t\t}, 100);\n\t\t});\n\t\tpaginationBlockEl.find('.pageup').off('click').on('click', navigator.scrollUp);\n\t\tpaginationBlockEl.find('.pagedown').off('click').on('click', navigator.scrollDown);\n\t\tpaginationBlockEl.find('.pagetop').off('click').on('click', navigator.toTop);\n\t\tpaginationBlockEl.find('.pagebottom').off('click').on('click', navigator.toBottom);\n\n\t\tpaginationBlockEl.find('input').on('keydown', function (e) {\n\t\t\tif (e.which === 13) {\n\t\t\t\tvar input = $(this);\n\t\t\t\tif (!utils.isNumber(input.val())) {\n\t\t\t\t\tinput.val('');\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar index = parseInt(input.val(), 10);\n\t\t\t\tif (typeof calculateIndex === 'function') {\n\t\t\t\t\tindex = calculateIndex(index, count);\n\t\t\t\t}\n\n\t\t\t\tvar url = generateUrl(index);\n\t\t\t\tinput.val('');\n\t\t\t\t$('.pagination-block .dropdown-toggle').trigger('click');\n\t\t\t\tajaxify.go(url);\n\t\t\t}\n\t\t});\n\n\t\t$('.pagination-block.visible-xs').on('touchstart', function (e) {\n\t\t\ttouchTooltipEl = $('.navigator-thumb');\n\t\t\ttouchTooltipEl.removeClass('hidden');\n\t\t\ttouchX = Math.min($(window).width(), Math.max(0, e.touches[0].clientX));\n\t\t\tupdateTooltip();\n\t\t\ttouchIntervalId = setInterval(updateTooltip, 100);\n\t\t}).on('touchmove', function (e) {\n\t\t\te.preventDefault();\n\t\t\te.stopPropagation();\n\t\t\tvar windowWidth = $(window).width();\n\t\t\ttouchX = Math.min(windowWidth, Math.max(0, e.touches[0].clientX));\n\t\t\tvar percent = touchX / windowWidth;\n\t\t\tindex = Math.max(1, Math.ceil(count * percent));\n\t\t\tindex = index > count ? count : index;\n\n\t\t\tnavigator.updateTextAndProgressBar();\n\t\t}).on('touchend', function () {\n\t\t\tif (touchIntervalId) {\n\t\t\t\tclearInterval(touchIntervalId);\n\t\t\t\ttouchIntervalId = 0;\n\t\t\t}\n\n\t\t\ttouchTooltipEl.addClass('hidden');\n\t\t\tnavigator.scrollToIndex(index - 1, true, 0);\n\t\t});\n\n\t\thandleKeys();\n\n\t\tnavigator.setCount(count);\n\t\tnavigator.update(0);\n\t};\n\n\tfunction updateTooltip() {\n\t\tif (touchIndex === index) {\n\t\t\treturn;\n\t\t}\n\t\ttouchIndex = index;\n\t\ttouchTooltipEl.css({ left: Math.min($(window).width() - touchTooltipEl.outerWidth(), Math.max(touchX - (touchTooltipEl.outerWidth() / 2), 0)) });\n\n\t\tsocket.emit('posts.getTimestampByIndex', { tid: ajaxify.data.tid, index: index - 1 }, function (err, timestamp) {\n\t\t\tif (err) {\n\t\t\t\treturn app.alertError(err.message);\n\t\t\t}\n\n\t\t\tvar relIndex = getRelativeIndex();\n\t\t\tvar date = new Date(timestamp);\n\t\t\tvar ds = date.toLocaleString(config.userLang, { month: 'long' });\n\t\t\ttouchTooltipEl.find('.text').translateText('[[global:pagination.out_of, ' + relIndex + ', ' + count + ']]');\n\t\t\tif (timestamp > Date.now() - (30 * 24 * 60 * 60 * 1000)) {\n\t\t\t\ttouchTooltipEl.find('.time').text(ds + ' ' + date.getDate());\n\t\t\t} else {\n\t\t\t\ttouchTooltipEl.find('.time').text(ds + ' ' + date.getFullYear());\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction handleKeys() {\n\t\tif (!config.usePagination) {\n\t\t\t$(window).off('keydown', onKeyDown).on('keydown', onKeyDown);\n\t\t}\n\t}\n\n\tfunction onKeyDown(ev) {\n\t\tif (ev.target.nodeName === 'BODY') {\n\t\t\tif (ev.shiftKey || ev.ctrlKey || ev.altKey) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (ev.which === 36 && navigator.toTop) { // home key\n\t\t\t\tnavigator.toTop();\n\t\t\t\treturn false;\n\t\t\t} else if (ev.which === 35 && navigator.toBottom) { // end key\n\t\t\t\tnavigator.toBottom();\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction generateUrl(index) {\n\t\tvar pathname = window.location.pathname.replace(config.relative_path, '');\n\t\tvar parts = pathname.split('/');\n\t\treturn parts[1] + '/' + parts[2] + '/' + parts[3] + (index ? '/' + index : '');\n\t}\n\n\tnavigator.setCount = function (value) {\n\t\tcount = parseInt(value, 10);\n\t\tnavigator.updateTextAndProgressBar();\n\t};\n\n\tnavigator.show = function () {\n\t\ttoggle(true);\n\t};\n\n\tnavigator.disable = function () {\n\t\tcount = 0;\n\t\tindex = 1;\n\t\tnavigator.callback = null;\n\t\tnavigator.selector = null;\n\t\t$(window).off('scroll', navigator.delayedUpdate);\n\n\t\ttoggle(false);\n\t};\n\n\tfunction toggle(flag) {\n\t\tvar path = ajaxify.removeRelativePath(window.location.pathname.slice(1));\n\t\tif (flag && (!path.startsWith('topic') && !path.startsWith('category'))) {\n\t\t\treturn;\n\t\t}\n\n\t\tpaginationBlockEl.toggleClass('ready', flag);\n\t}\n\n\tnavigator.delayedUpdate = function () {\n\t\tif (!navigatorUpdateTimeoutId) {\n\t\t\tnavigatorUpdateTimeoutId = setTimeout(function () {\n\t\t\t\tnavigator.update();\n\t\t\t\tnavigatorUpdateTimeoutId = undefined;\n\t\t\t}, 100);\n\t\t}\n\t};\n\n\tnavigator.update = function (threshold) {\n\t\t/*\n\t\t\tThe \"threshold\" is defined as the distance from the top of the page to\n\t\t\ta spot where a user is expecting to begin reading.\n\t\t*/\n\t\tthreshold = typeof threshold === 'number' ? threshold : undefined;\n\n\t\tvar els = $(navigator.selector);\n\t\tif (els.length) {\n\t\t\tindex = parseInt(els.first().attr('data-index'), 10) + 1;\n\t\t}\n\n\t\tvar scrollTop = $(window).scrollTop();\n\t\tvar windowHeight = $(window).height();\n\t\tvar documentHeight = $(document).height();\n\t\tvar middleOfViewport = scrollTop + (windowHeight / 2);\n\t\tvar previousDistance = Number.MAX_VALUE;\n\t\tels.each(function () {\n\t\t\tvar distanceToMiddle = Math.abs(middleOfViewport - $(this).offset().top);\n\n\t\t\tif (distanceToMiddle > previousDistance) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (distanceToMiddle < previousDistance) {\n\t\t\t\tindex = parseInt($(this).attr('data-index'), 10) + 1;\n\t\t\t\tpreviousDistance = distanceToMiddle;\n\t\t\t}\n\t\t});\n\n\t\tvar atTop = scrollTop === 0 && parseInt(els.first().attr('data-index'), 10) === 0;\n\t\tvar nearBottom = scrollTop + windowHeight > documentHeight - 100 && parseInt(els.last().attr('data-index'), 10) === count - 1;\n\n\t\tif (atTop) {\n\t\t\tindex = 1;\n\t\t} else if (nearBottom) {\n\t\t\tindex = count;\n\t\t}\n\n\t\t// If a threshold is undefined, try to determine one based on new index\n\t\tif (threshold === undefined && ajaxify.data.template.topic === true) {\n\t\t\tif (atTop) {\n\t\t\t\tthreshold = 0;\n\t\t\t} else {\n\t\t\t\tvar anchorEl = components.get('post/anchor', index - 1);\n\t\t\t\tif (anchorEl.length) {\n\t\t\t\t\tvar anchorRect = anchorEl.get(0).getBoundingClientRect();\n\t\t\t\t\tthreshold = anchorRect.top;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (typeof navigator.callback === 'function') {\n\t\t\tnavigator.callback(index, count, threshold);\n\t\t}\n\n\t\tnavigator.updateTextAndProgressBar();\n\t\ttoggle(!!count);\n\t};\n\n\tnavigator.updateTextAndProgressBar = function () {\n\t\tif (!utils.isNumber(index)) {\n\t\t\treturn;\n\t\t}\n\t\tindex = index > count ? count : index;\n\t\tvar relIndex = getRelativeIndex();\n\t\tpaginationTextEl.translateHtml('[[global:pagination.out_of, ' + relIndex + ', ' + count + ']]');\n\t\tvar fraction = (relIndex - 1) / (count - 1 || 1);\n\t\tpaginationBlockMeterEl.val(fraction);\n\t\tpaginationBlockProgressEl.width((fraction * 100) + '%');\n\t};\n\n\tfunction getRelativeIndex() {\n\t\tvar relIndex = index;\n\t\tif (relIndex === 1) {\n\t\t\treturn 1;\n\t\t}\n\t\tif (ajaxify.data.template.topic) {\n\t\t\tif (config.topicPostSort === 'most_votes' || config.topicPostSort === 'newest_to_oldest') {\n\t\t\t\trelIndex = ajaxify.data.postcount - index + 2;\n\t\t\t}\n\t\t}\n\t\treturn relIndex;\n\t}\n\n\tnavigator.scrollUp = function () {\n\t\tvar $window = $(window);\n\n\t\tif (config.usePagination) {\n\t\t\tvar atTop = $window.scrollTop() <= 0;\n\t\t\tif (atTop) {\n\t\t\t\treturn pagination.previousPage(function () {\n\t\t\t\t\t$('body,html').scrollTop($(document).height() - $window.height());\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\t$('body,html').animate({\n\t\t\tscrollTop: $window.scrollTop() - $window.height(),\n\t\t});\n\t};\n\n\tnavigator.scrollDown = function () {\n\t\tvar $window = $(window);\n\n\t\tif (config.usePagination) {\n\t\t\tvar atBottom = $window.scrollTop() >= $(document).height() - $window.height();\n\t\t\tif (atBottom) {\n\t\t\t\treturn pagination.nextPage();\n\t\t\t}\n\t\t}\n\t\t$('body,html').animate({\n\t\t\tscrollTop: $window.scrollTop() + $window.height(),\n\t\t});\n\t};\n\n\tnavigator.scrollTop = function (index) {\n\t\tif ($(navigator.selector + '[data-index=\"' + index + '\"]').length) {\n\t\t\tnavigator.scrollToIndex(index, true);\n\t\t} else {\n\t\t\tajaxify.go(generateUrl());\n\t\t}\n\t};\n\n\tnavigator.scrollBottom = function (index) {\n\t\tif (parseInt(index, 10) < 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tif ($(navigator.selector + '[data-index=\"' + index + '\"]').length) {\n\t\t\tnavigator.scrollToIndex(index, true);\n\t\t} else {\n\t\t\tindex = parseInt(index, 10) + 1;\n\t\t\tajaxify.go(generateUrl(index));\n\t\t}\n\t};\n\n\tnavigator.scrollToIndex = function (index, highlight, duration) {\n\t\tvar inTopic = !!components.get('topic').length;\n\t\tvar inCategory = !!components.get('category').length;\n\n\t\tif (!utils.isNumber(index) || (!inTopic && !inCategory)) {\n\t\t\treturn;\n\t\t}\n\n\t\tduration = duration !== undefined ? duration : 400;\n\t\tnavigator.scrollActive = true;\n\n\t\t// if in topic and item already on page\n\t\tif (inTopic && components.get('post/anchor', index).length) {\n\t\t\treturn navigator.scrollToPostIndex(index, highlight, duration);\n\t\t}\n\n\t\t// if in category and item alreay on page\n\t\tif (inCategory && $('[component=\"category/topic\"][data-index=\"' + index + '\"]').length) {\n\t\t\treturn navigator.scrollToTopicIndex(index, highlight, duration);\n\t\t}\n\n\t\tif (!config.usePagination) {\n\t\t\tnavigator.scrollActive = false;\n\t\t\tindex = parseInt(index, 10) + 1;\n\t\t\tajaxify.go(generateUrl(index));\n\t\t\treturn;\n\t\t}\n\n\t\tvar scrollMethod = inTopic ? navigator.scrollToPostIndex : navigator.scrollToTopicIndex;\n\t\tif (inTopic) {\n\t\t\tif (config.topicPostSort === 'most_votes' || config.topicPostSort === 'newest_to_oldest') {\n\t\t\t\tindex = ajaxify.data.postcount - index;\n\t\t\t}\n\t\t} else if (inCategory) {\n\t\t\tif (config.categoryTopicSort === 'most_posts' || config.categoryTopicSort === 'oldest_to_newest') {\n\t\t\t\tindex = ajaxify.data.topic_count - index;\n\t\t\t}\n\t\t}\n\n\t\tvar page = Math.max(1, Math.ceil((index + 1) / config.postsPerPage));\n\n\t\tif (parseInt(page, 10) !== ajaxify.data.pagination.currentPage) {\n\t\t\tpagination.loadPage(page, function () {\n\t\t\t\tscrollMethod(index, highlight, duration);\n\t\t\t});\n\t\t} else {\n\t\t\tscrollMethod(index, highlight, duration);\n\t\t}\n\t};\n\n\tnavigator.scrollToPostIndex = function (postIndex, highlight, duration) {\n\t\tvar scrollTo = components.get('post', 'index', postIndex);\n\t\tnavigator.scrollToElement(scrollTo, highlight, duration);\n\t};\n\n\tnavigator.scrollToTopicIndex = function (topicIndex, highlight, duration) {\n\t\tvar scrollTo = $('[component=\"category/topic\"][data-index=\"' + topicIndex + '\"]');\n\t\tnavigator.scrollToElement(scrollTo, highlight, duration);\n\t};\n\n\tnavigator.scrollToElement = function (scrollTo, highlight, duration) {\n\t\tif (!scrollTo.length) {\n\t\t\tnavigator.scrollActive = false;\n\t\t\treturn;\n\t\t}\n\t\tvar postHeight = scrollTo.height();\n\t\tvar viewportHeight = $(window).height();\n\t\tvar navbarHeight = components.get('navbar').height();\n\n\t\t// Temporarily disable navigator update on scroll\n\t\t$(window).off('scroll', navigator.update);\n\n\t\tduration = duration !== undefined ? duration : 400;\n\t\tnavigator.scrollActive = true;\n\t\tvar done = false;\n\n\t\tfunction animateScroll() {\n\t\t\tfunction onAnimateComplete() {\n\t\t\t\tif (done) {\n\t\t\t\t\t// Re-enable onScroll behaviour\n\t\t\t\t\t$(window).on('scroll', navigator.update);\n\t\t\t\t\tvar scrollToRect = scrollTo.get(0).getBoundingClientRect();\n\t\t\t\t\tnavigator.update(scrollToRect.top);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tdone = true;\n\n\t\t\t\tnavigator.scrollActive = false;\n\t\t\t\thighlightPost();\n\t\t\t\t$('body').scrollTop($('body').scrollTop() - 1);\n\t\t\t\t$('html').scrollTop($('html').scrollTop() - 1);\n\t\t\t}\n\n\t\t\tvar scrollTop = 0;\n\t\t\tif (postHeight < viewportHeight) {\n\t\t\t\tscrollTop = (scrollTo.offset().top - (viewportHeight / 2) + (postHeight / 2));\n\t\t\t} else {\n\t\t\t\tscrollTop = scrollTo.offset().top - navbarHeight;\n\t\t\t}\n\t\t\tif (duration === 0) {\n\t\t\t\t$(window).scrollTop(scrollTop);\n\t\t\t\treturn onAnimateComplete();\n\t\t\t}\n\t\t\t$('html, body').animate({\n\t\t\t\tscrollTop: scrollTop + 'px',\n\t\t\t}, duration, onAnimateComplete);\n\t\t}\n\n\t\tfunction highlightPost() {\n\t\t\tif (highlight) {\n\t\t\t\tscrollTo.addClass('highlight');\n\t\t\t\tsetTimeout(function () {\n\t\t\t\t\tscrollTo.removeClass('highlight');\n\t\t\t\t}, 10000);\n\t\t\t}\n\t\t}\n\n\t\tanimateScroll();\n\t};\n\n\treturn navigator;\n});\n"]}