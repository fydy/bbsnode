{"version":3,"sources":["public/src/modules/taskbar.js"],"names":["define","Benchpress","translator","taskbar","init","self","this","parse","html","$","tasklist","find","document","body","append","on","$btn","module","attr","uuid","require","hasClass","minimizeAll","load","toggleNew","app","alternatingTitle","removeClass","addClass","minimize","window","closeAll","close","btnEl","fnName","length","selector","each","idx","el","getAttribute","discard","remove","update","push","options","element","data","trigger","createTaskbar","get","items","map","toggleClass","state","silent","updateActive","tasks","filter","isActive","taskBtn","removeAttr","translate","title","taskTitle","text","taskbarEl","className","icon","image","data-module","data-uuid","undefined","updateTitle","newTitle"],"mappings":"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","file":"public/src/modules/taskbar.js","sourcesContent":["'use strict';\n\n\ndefine('taskbar', ['benchpress', 'translator'], function (Benchpress, translator) {\n\tvar taskbar = {};\n\n\ttaskbar.init = function () {\n\t\tvar self = this;\n\n\t\tBenchpress.parse('modules/taskbar', {}, function (html) {\n\t\t\tself.taskbar = $(html);\n\t\t\tself.tasklist = self.taskbar.find('ul');\n\t\t\t$(document.body).append(self.taskbar);\n\n\t\t\tself.taskbar.on('click', 'li', function () {\n\t\t\t\tvar\t$btn = $(this);\n\t\t\t\tvar module = $btn.attr('data-module');\n\t\t\t\tvar uuid = $btn.attr('data-uuid');\n\n\t\t\t\trequire([module], function (module) {\n\t\t\t\t\tif (!$btn.hasClass('active')) {\n\t\t\t\t\t\tminimizeAll();\n\t\t\t\t\t\tmodule.load(uuid);\n\t\t\t\t\t\ttaskbar.toggleNew(uuid, false);\n\t\t\t\t\t\tapp.alternatingTitle('');\n\n\t\t\t\t\t\ttaskbar.tasklist.removeClass('active');\n\t\t\t\t\t\t$btn.addClass('active');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tmodule.minimize(uuid);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn false;\n\t\t\t});\n\t\t});\n\n\t\t$(window).on('action:app.loggedOut', function () {\n\t\t\ttaskbar.closeAll();\n\t\t});\n\t};\n\n\ttaskbar.close = function (module, uuid) {\n\t\t// Sends signal to the appropriate module's .close() fn (if present)\n\t\tvar btnEl = taskbar.tasklist.find('[data-module=\"' + module + '\"][data-uuid=\"' + uuid + '\"]');\n\t\tvar fnName = 'close';\n\n\t\t// TODO: Refactor chat module to not take uuid in close instead of by jQuery element\n\t\tif (module === 'chat') {\n\t\t\tfnName = 'closeByUUID';\n\t\t}\n\n\t\tif (btnEl.length) {\n\t\t\trequire([module], function (module) {\n\t\t\t\tif (typeof module[fnName] === 'function') {\n\t\t\t\t\tmodule[fnName](uuid);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t};\n\n\ttaskbar.closeAll = function (module) {\n\t\t// module is optional\n\t\tvar selector = '[data-uuid]';\n\n\t\tif (module) {\n\t\t\tselector = '[data-module=\"' + module + '\"]' + selector;\n\t\t}\n\n\t\ttaskbar.tasklist.find(selector).each(function (idx, el) {\n\t\t\ttaskbar.close(module || el.getAttribute('data-module'), el.getAttribute('data-uuid'));\n\t\t});\n\t};\n\n\ttaskbar.discard = function (module, uuid) {\n\t\tvar btnEl = taskbar.tasklist.find('[data-module=\"' + module + '\"][data-uuid=\"' + uuid + '\"]');\n\t\tbtnEl.remove();\n\n\t\tupdate();\n\t};\n\n\ttaskbar.push = function (module, uuid, options) {\n\t\tvar element = taskbar.tasklist.find('li[data-uuid=\"' + uuid + '\"]');\n\n\t\tvar data = {\n\t\t\tmodule: module,\n\t\t\tuuid: uuid,\n\t\t\toptions: options,\n\t\t\telement: element,\n\t\t};\n\n\t\t$(window).trigger('filter:taskbar.push', data);\n\n\t\tif (!element.length && data.module) {\n\t\t\tcreateTaskbar(data);\n\t\t}\n\t};\n\n\ttaskbar.get = function (module) {\n\t\tvar items = $('[data-module=\"' + module + '\"]').map(function (idx, el) {\n\t\t\treturn $(el).data();\n\t\t});\n\n\t\treturn items;\n\t};\n\n\ttaskbar.minimize = function (module, uuid) {\n\t\tvar btnEl = taskbar.tasklist.find('[data-module=\"' + module + '\"][data-uuid=\"' + uuid + '\"]');\n\t\tbtnEl.toggleClass('active', false);\n\t};\n\n\ttaskbar.toggleNew = function (uuid, state, silent) {\n\t\tvar btnEl = taskbar.tasklist.find('[data-uuid=\"' + uuid + '\"]');\n\t\tbtnEl.toggleClass('new', state);\n\n\t\tif (!silent) {\n\t\t\t$(window).trigger('action:taskbar.toggleNew', uuid);\n\t\t}\n\t};\n\n\ttaskbar.updateActive = function (uuid) {\n\t\tvar\ttasks = taskbar.tasklist.find('li');\n\t\ttasks.removeClass('active');\n\t\ttasks.filter('[data-uuid=\"' + uuid + '\"]').addClass('active');\n\n\t\t$('[data-uuid]:not([data-module])').toggleClass('modal-unfocused', true);\n\t\t$('[data-uuid=\"' + uuid + '\"]:not([data-module])').toggleClass('modal-unfocused', false);\n\t};\n\n\ttaskbar.isActive = function (uuid) {\n\t\tvar taskBtn = taskbar.tasklist.find('li[data-uuid=\"' + uuid + '\"]');\n\t\treturn taskBtn.hasClass('active');\n\t};\n\n\tfunction update() {\n\t\tvar\ttasks = taskbar.tasklist.find('li');\n\n\t\tif (tasks.length > 0) {\n\t\t\ttaskbar.taskbar.attr('data-active', '1');\n\t\t} else {\n\t\t\ttaskbar.taskbar.removeAttr('data-active');\n\t\t}\n\t}\n\n\tfunction minimizeAll() {\n\t\ttaskbar.tasklist.find('.active').removeClass('active');\n\t}\n\n\tfunction createTaskbar(data) {\n\t\ttranslator.translate(data.options.title, function (taskTitle) {\n\t\t\tvar title = $('<div></div>').text(taskTitle || 'NodeBB Task').html();\n\n\t\t\tvar\ttaskbarEl = $('<li />')\n\t\t\t\t.addClass(data.options.className)\n\t\t\t\t.html('<a href=\"#\">' +\n\t\t\t\t\t(data.options.icon ? '<i class=\"fa ' + data.options.icon + '\"></i> ' : '') +\n\t\t\t\t\t(data.options.image ? '<img src=\"' + data.options.image + '\"/> ' : '') +\n\t\t\t\t\t'<span component=\"taskbar/title\">' + title + '</span>' +\n\t\t\t\t\t'</a>')\n\t\t\t\t.attr({\n\t\t\t\t\ttitle: title,\n\t\t\t\t\t'data-module': data.module,\n\t\t\t\t\t'data-uuid': data.uuid,\n\t\t\t\t})\n\t\t\t\t.addClass(data.options.state !== undefined ? data.options.state : 'active');\n\n\t\t\tif (!data.options.state || data.options.state === 'active') {\n\t\t\t\tminimizeAll();\n\t\t\t}\n\n\t\t\ttaskbar.tasklist.append(taskbarEl);\n\t\t\tupdate();\n\n\t\t\tdata.element = taskbarEl;\n\n\t\t\ttaskbarEl.data(data);\n\t\t\t$(window).trigger('action:taskbar.pushed', data);\n\t\t});\n\t}\n\n\ttaskbar.updateTitle = function (module, uuid, newTitle) {\n\t\ttaskbar.tasklist.find('[data-module=\"' + module + '\"][data-uuid=\"' + uuid + '\"] [component=\"taskbar/title\"]').text(newTitle);\n\t};\n\n\treturn taskbar;\n});\n"]}